<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NZ House Price Index Comparison</title>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

	<!-- XML Data-->
	<script>
		const xmlRawData = `
	<records>
		<record>
			<Date>1990-03</Date>
			<HPI>477</HPI>
		</record>
		<record>
			<Date>1990-06</Date>
			<HPI>480</HPI>
		</record>
		<record>
			<Date>1990-09</Date>
			<HPI>483</HPI>
		</record>
		<record>
			<Date>1990-12</Date>
			<HPI>482</HPI>
		</record>
		<record>
			<Date>1991-03</Date>
			<HPI>479</HPI>
		</record>
		<record>
			<Date>1991-06</Date>
			<HPI>470</HPI>
		</record>
		<record>
			<Date>1991-09</Date>
			<HPI>468</HPI>
		</record>
		<record>
			<Date>1991-12</Date>
			<HPI>466</HPI>
		</record>
		<record>
			<Date>1992-03</Date>
			<HPI>468</HPI>
		</record>
		<record>
			<Date>1992-06</Date>
			<HPI>467</HPI>
		</record>
		<record>
			<Date>1992-09</Date>
			<HPI>470</HPI>
		</record>
		<record>
			<Date>1992-12</Date>
			<HPI>477</HPI>
		</record>
		<record>
			<Date>1993-03</Date>
			<HPI>481</HPI>
		</record>
		<record>
			<Date>1993-06</Date>
			<HPI>482</HPI>
		</record>
		<record>
			<Date>1993-09</Date>
			<HPI>491</HPI>
		</record>
		<record>
			<Date>1993-12</Date>
			<HPI>503</HPI>
		</record>
		<record>
			<Date>1994-03</Date>
			<HPI>520</HPI>
		</record>
		<record>
			<Date>1994-06</Date>
			<HPI>536</HPI>
		</record>
		<record>
			<Date>1994-09</Date>
			<HPI>554</HPI>
		</record>
		<record>
			<Date>1994-12</Date>
			<HPI>572</HPI>
		</record>
		<record>
			<Date>1995-03</Date>
			<HPI>579</HPI>
		</record>
		<record>
			<Date>1995-06</Date>
			<HPI>585</HPI>
		</record>
		<record>
			<Date>1995-09</Date>
			<HPI>599</HPI>
		</record>
		<record>
			<Date>1995-12</Date>
			<HPI>621</HPI>
		</record>
		<record>
			<Date>1996-03</Date>
			<HPI>653</HPI>
		</record>
		<record>
			<Date>1996-06</Date>
			<HPI>663</HPI>
		</record>
		<record>
			<Date>1996-09</Date>
			<HPI>662</HPI>
		</record>
		<record>
			<Date>1996-12</Date>
			<HPI>680</HPI>
		</record>
		<record>
			<Date>1997-03</Date>
			<HPI>696</HPI>
		</record>
		<record>
			<Date>1997-06</Date>
			<HPI>702</HPI>
		</record>
		<record>
			<Date>1997-09</Date>
			<HPI>706</HPI>
		</record>
		<record>
			<Date>1997-12</Date>
			<HPI>715</HPI>
		</record>
		<record>
			<Date>1998-03</Date>
			<HPI>709</HPI>
		</record>
		<record>
			<Date>1998-06</Date>
			<HPI>688</HPI>
		</record>
		<record>
			<Date>1998-09</Date>
			<HPI>677</HPI>
		</record>
		<record>
			<Date>1998-12</Date>
			<HPI>690</HPI>
		</record>
		<record>
			<Date>1999-03</Date>
			<HPI>701</HPI>
		</record>
		<record>
			<Date>1999-06</Date>
			<HPI>705</HPI>
		</record>
		<record>
			<Date>1999-09</Date>
			<HPI>706</HPI>
		</record>
		<record>
			<Date>1999-12</Date>
			<HPI>705</HPI>
		</record>
		<record>
			<Date>2000-03</Date>
			<HPI>705</HPI>
		</record>
		<record>
			<Date>2000-06</Date>
			<HPI>698</HPI>
		</record>
		<record>
			<Date>2000-09</Date>
			<HPI>697</HPI>
		</record>
		<record>
			<Date>2000-12</Date>
			<HPI>697</HPI>
		</record>
		<record>
			<Date>2001-03</Date>
			<HPI>701</HPI>
		</record>
		<record>
			<Date>2001-06</Date>
			<HPI>700</HPI>
		</record>
		<record>
			<Date>2001-09</Date>
			<HPI>706</HPI>
		</record>
		<record>
			<Date>2001-12</Date>
			<HPI>718</HPI>
		</record>
		<record>
			<Date>2002-03</Date>
			<HPI>737</HPI>
		</record>
		<record>
			<Date>2002-06</Date>
			<HPI>752</HPI>
		</record>
		<record>
			<Date>2002-09</Date>
			<HPI>773</HPI>
		</record>
		<record>
			<Date>2002-12</Date>
			<HPI>801</HPI>
		</record>
		<record>
			<Date>2003-03</Date>
			<HPI>842</HPI>
		</record>
		<record>
			<Date>2003-06</Date>
			<HPI>871</HPI>
		</record>
		<record>
			<Date>2003-09</Date>
			<HPI>938</HPI>
		</record>
		<record>
			<Date>2003-12</Date>
			<HPI>1000</HPI>
		</record>
		<record>
			<Date>2004-03</Date>
			<HPI>1041</HPI>
		</record>
		<record>
			<Date>2004-06</Date>
			<HPI>1066</HPI>
		</record>
		<record>
			<Date>2004-09</Date>
			<HPI>1091</HPI>
		</record>
		<record>
			<Date>2004-12</Date>
			<HPI>1125</HPI>
		</record>
		<record>
			<Date>2005-03</Date>
			<HPI>1180</HPI>
		</record>
		<record>
			<Date>2005-06</Date>
			<HPI>1214</HPI>
		</record>
		<record>
			<Date>2005-09</Date>
			<HPI>1251</HPI>
		</record>
		<record>
			<Date>2005-12</Date>
			<HPI>1300</HPI>
		</record>
		<record>
			<Date>2006-03</Date>
			<HPI>1324</HPI>
		</record>
		<record>
			<Date>2006-06</Date>
			<HPI>1337</HPI>
		</record>
		<record>
			<Date>2006-09</Date>
			<HPI>1370</HPI>
		</record>
		<record>
			<Date>2006-12</Date>
			<HPI>1418</HPI>
		</record>
		<record>
			<Date>2007-03</Date>
			<HPI>1479</HPI>
		</record>
		<record>
			<Date>2007-06</Date>
			<HPI>1520</HPI>
		</record>
		<record>
			<Date>2007-09</Date>
			<HPI>1526</HPI>
		</record>
		<record>
			<Date>2007-12</Date>
			<HPI>1531</HPI>
		</record>
		<record>
			<Date>2008-03</Date>
			<HPI>1521</HPI>
		</record>
		<record>
			<Date>2008-06</Date>
			<HPI>1453</HPI>
		</record>
		<record>
			<Date>2008-09</Date>
			<HPI>1423</HPI>
		</record>
		<record>
			<Date>2008-12</Date>
			<HPI>1395</HPI>
		</record>
		<record>
			<Date>2009-03</Date>
			<HPI>1383</HPI>
		</record>
		<record>
			<Date>2009-06</Date>
			<HPI>1407</HPI>
		</record>
		<record>
			<Date>2009-09</Date>
			<HPI>1438</HPI>
		</record>
		<record>
			<Date>2009-12</Date>
			<HPI>1468</HPI>
		</record>
		<record>
			<Date>2010-03</Date>
			<HPI>1469</HPI>
		</record>
		<record>
			<Date>2010-06</Date>
			<HPI>1455</HPI>
		</record>
		<record>
			<Date>2010-09</Date>
			<HPI>1445</HPI>
		</record>
		<record>
			<Date>2010-12</Date>
			<HPI>1444</HPI>
		</record>
		<record>
			<Date>2011-03</Date>
			<HPI>1447</HPI>
		</record>
		<record>
			<Date>2011-06</Date>
			<HPI>1452</HPI>
		</record>
		<record>
			<Date>2011-09</Date>
			<HPI>1474</HPI>
		</record>
		<record>
			<Date>2011-12</Date>
			<HPI>1477</HPI>
		</record>
		<record>
			<Date>2012-03</Date>
			<HPI>1493</HPI>
		</record>
		<record>
			<Date>2012-06</Date>
			<HPI>1510</HPI>
		</record>
		<record>
			<Date>2012-09</Date>
			<HPI>1541</HPI>
		</record>
		<record>
			<Date>2012-12</Date>
			<HPI>1572</HPI>
		</record>
		<record>
			<Date>2013-03</Date>
			<HPI>1609</HPI>
		</record>
		<record>
			<Date>2013-06</Date>
			<HPI>1645</HPI>
		</record>
		<record>
			<Date>2013-09</Date>
			<HPI>1697</HPI>
		</record>
		<record>
			<Date>2013-12</Date>
			<HPI>1715</HPI>
		</record>
		<record>
			<Date>2014-03</Date>
			<HPI>1734</HPI>
		</record>
		<record>
			<Date>2014-06</Date>
			<HPI>1749</HPI>
		</record>
		<record>
			<Date>2014-09</Date>
			<HPI>1778</HPI>
		</record>
		<record>
			<Date>2014-12</Date>
			<HPI>1835</HPI>
		</record>
		<record>
			<Date>2015-03</Date>
			<HPI>1892</HPI>
		</record>
		<record>
			<Date>2015-06</Date>
			<HPI>1956</HPI>
		</record>
		<record>
			<Date>2015-09</Date>
			<HPI>2045</HPI>
		</record>
		<record>
			<Date>2015-12</Date>
			<HPI>2060</HPI>
		</record>
		<record>
			<Date>2016-03</Date>
			<HPI>2136</HPI>
		</record>
		<record>
			<Date>2016-06</Date>
			<HPI>2249</HPI>
		</record>
		<record>
			<Date>2016-09</Date>
			<HPI>2333</HPI>
		</record>
		<record>
			<Date>2016-12</Date>
			<HPI>2355</HPI>
		</record>
		<record>
			<Date>2017-03</Date>
			<HPI>2391</HPI>
		</record>
		<record>
			<Date>2017-06</Date>
			<HPI>2395</HPI>
		</record>
		<record>
			<Date>2017-09</Date>
			<HPI>2422</HPI>
		</record>
		<record>
			<Date>2017-12</Date>
			<HPI>2449</HPI>
		</record>
		<record>
			<Date>2018-03</Date>
			<HPI>2481</HPI>
		</record>
		<record>
			<Date>2018-06</Date>
			<HPI>2481</HPI>
		</record>
		<record>
			<Date>2018-09</Date>
			<HPI>2495</HPI>
		</record>
		<record>
			<Date>2018-12</Date>
			<HPI>2517</HPI>
		</record>
		<record>
			<Date>2019-03</Date>
			<HPI>2526</HPI>
		</record>
		<record>
			<Date>2019-06</Date>
			<HPI>2518</HPI>
		</record>
		<record>
			<Date>2019-09</Date>
			<HPI>2565</HPI>
		</record>
		<record>
			<Date>2019-12</Date>
			<HPI>2633</HPI>
		</record>
		<record>
			<Date>2020-03</Date>
			<HPI>2722</HPI>
		</record>
		<record>
			<Date>2020-06</Date>
			<HPI>2696</HPI>
		</record>
		<record>
			<Date>2020-09</Date>
			<HPI>2839</HPI>
		</record>
		<record>
			<Date>2020-12</Date>
			<HPI>3081</HPI>
		</record>
		<record>
			<Date>2021-03</Date>
			<HPI>3379</HPI>
		</record>
		<record>
			<Date>2021-06</Date>
			<HPI>3495</HPI>
		</record>
		<record>
			<Date>2021-09</Date>
			<HPI>3704</HPI>
		</record>
		<record>
			<Date>2021-12</Date>
			<HPI>3920</HPI>
		</record>
		<record>
			<Date>2022-03</Date>
			<HPI>3846</HPI>
		</record>
		<record>
			<Date>2022-06</Date>
			<HPI>3681</HPI>
		</record>
		<record>
			<Date>2022-09</Date>
			<HPI>3548</HPI>
		</record>
		<record>
			<Date>2022-12</Date>
			<HPI>3484</HPI>
		</record>
		<record>
			<Date>2023-03</Date>
			<HPI>3382</HPI>
		</record>
		<record>
			<Date>2023-06</Date>
			<HPI>3349</HPI>
		</record>
		<record>
			<Date>2023-09</Date>
			<HPI>3404</HPI>
		</record>
		<record>
			<Date>2023-12</Date>
			<HPI>3458</HPI>
		</record>
	</records>
	`;
	</script>

	<!--JavaScript-->
	<script>
		const parser = new DOMParser();
		const xmlData = parser.parseFromString(xmlRawData, "text/xml");
		const xmlRecords = xmlData.getElementsByTagName("record")

		const latestHPIDate = xmlRecords[xmlRecords.length - 1]
			.getElementsByTagName("Date")[0].textContent;

		const latestHPI = new Number(xmlRecords[xmlRecords.length - 1]
			.getElementsByTagName("HPI")[0].textContent);

		let xValuesChart = [];
		let yValuesChart = [];

		function getChartData() {
			// Get the last five years of data for the line chart
			for (let i = xmlRecords.length - 21; i < xmlRecords.length; i++) {

				xValuesChart.push(new Date(xmlRecords[i].getElementsByTagName("Date")[0]
					.textContent).toLocaleString("en-NZ", { month: 'long', year: 'numeric' }));
				yValuesChart.push(xmlRecords[i].getElementsByTagName("HPI")[0].textContent);
			}
		}

		function getClosestHPI(inDate) {
			if (inDate >= latestHPIDate) {
				return latestHPIDate
			}
			else if (inDate == '1990-01') {
				return "1990-03"
			}

			const dateArray = inDate.split("-");
			let year = dateArray[0];
			let month = dateArray[1];

			if (month == '02' || month == '04') {
				month = '03'
			}
			else if (month == '05' || month == '07') {
				month = '06'
			}
			else if (month == '08' || month == '10') {
				month = '09'
			}
			else if (month == '11') {
				month = '12'
			}
			else if (month == '01') {
				month = '12'
				year = year - 1
			}
			return year + "-" + month
		}

		function displayResult() {
			document.getElementById("instructions").style.display = "none";

			let date = document.getElementById("purYear").value + "-" + document.getElementById("purMonth").value;
			let dateHPI = getClosestHPI(date)
			let dateObject = new Date(date)

			let purPrice = new Number(document.getElementById("purPrice").value);
			let purUnit = new Number(document.getElementById("unit").value);
			purPrice = purPrice * purUnit;

			let hpi;

			for (let i = 0; i < xmlRecords.length; i++) {
				iDate = xmlRecords[i].getElementsByTagName("Date")[0].textContent;
				if (dateHPI == iDate) {
					hpi = new Number(xmlRecords[i].getElementsByTagName("HPI")[0].textContent);
					//Update chart
					xValuesChart = [];
					yValuesChart = [];

					for (i + 1; i < xmlRecords.length; i++) {
						xValuesChart.push(new Date(xmlRecords[i].getElementsByTagName("Date")[0]
							.textContent).toLocaleString("en-NZ", { month: 'long', year: 'numeric' }));
						let iHPI = new Number(xmlRecords[i].getElementsByTagName("HPI")[0].textContent)
						let iAdjPrice = new Number(iHPI / hpi * purPrice)
						yValuesChart.push(iAdjPrice.toFixed().toLocaleString());
					}

					chart.destroy()

					chart = new Chart(document.getElementById('lineChart'), {
						type: "line",
						data: {
							labels: xValuesChart,
							datasets: [{
								backgroundColor: "rgba(0,0,255,1.0)",
								borderColor: "rgba(0,0,255,0.1)",
								data: yValuesChart,
								label: 'HPI-adjusted house price',
							}]
						},
						options: {
							plugins: {
								title: {
									display: true,
									text: 'Tracked house price against HPI since your query date'
								}
							},
							scales: {
								y: {
									ticks: {
										// Include a dollar sign in the ticks
										callback: function (value, index, ticks) {
											return '$' + value;
										}
									}
								}
							}
						}
					});
					break;
				}
			}

			let multiplier = latestHPI / hpi;
			let adjPrice = purPrice * multiplier;

			let directionText = "not changed";

			if (latestHPI < hpi) {
				directionText = "decreased"
			} else if (latestHPI > hpi) {
				directionText = "increased"
			}

			let result =
				"<h4>Buying in " + dateObject.toLocaleString("en-NZ", { month: 'long', year: 'numeric' }) +
				" for $" + purPrice.toLocaleString() +
				" is like buying today for $" + new Number(adjPrice.toFixed()).toLocaleString() +
				".</h4>" +
				"<h5>According to the index, the property has " + directionText + " in value since the seller bought it.</h5>" +
				"<i><br>The index can't tell you if significant improvements have been made to the property,<br> or other special circumstances like subdividability.</i>" +
				"<br><br> If the seller wants more than $" + new Number(adjPrice.toFixed()).toLocaleString() + " the property could be overpriced, or special enough to justify it - maybe a valuation could help." +
				"<br>The graph below shows the adjusted house price every quarter until today." +
				"<br><br><button onclick=\"showMoreInfo()\">HPI info...</button>";

			let hpiResult = "The HPI used was from " +
				new Date(dateHPI).toLocaleString("en-NZ", { month: 'long', year: 'numeric' }) +
				" at value " + hpi + " and the latest HPI is " + latestHPI + ".<br>" +
				"We need to multiply the older HPI by " + multiplier.toPrecision(3) + " to get to the latest HPI.<br>" +
				"We do the same to the original purchase price and that tells us how much that would be today.";

			document.getElementById('divResult').innerHTML = result;
			document.getElementById('hpiResult').innerHTML = hpiResult;

		}
		function showMoreInfo() {
			document.getElementById("hpiResult").style.display = "";
		}
	</script>
</head>

<body>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
		crossorigin="anonymous"></script>
	<div id="intro" style="text-align: center">
		<br>
		<h2>Check today's value of a New Zealand property using the last sale price</h2>
		<i>New Zealand property prices go up and down - we can estimate what a seller really paid in today's dollars
			using the <a href="https://www.rbnz.govt.nz/statistics/series/economic-indicators/housing">Reserve Bank
				HPI</a> data.</i><br>
		<div id="instructions">
			<br>First, find the last sale price using the <a href="https://www.trademe.co.nz/a/property">TradeMe
				Property</a> listing, or the <a href="https://www.qv.co.nz/">QV lookup</a>, or your favourite property
			information site.
		</div>
	</div>
	<div id="queryBox" style="text-align: center">
		<br>The current seller bought in
		<select class="selectbox" id="purMonth" name="purMonth" required>
			<option value="01">January</option>
			<option value="02">February</option>
			<option value="03">March</option>
			<option value="04">April</option>
			<option value="05">May</option>
			<option value="06">June</option>
			<option value="07">July</option>
			<option value="08">August</option>
			<option value="09">September</option>
			<option value="10">October</option>
			<option value="11">November</option>
			<option value="12">December</option>
		</select>
		<select class="selectbox" id="purYear" name="purYear" required>
			<option value="2024">2024</option>
			<option value="2023">2023</option>
			<option value="2022">2022</option>
			<option value="2021">2021</option>
			<option value="2020">2020</option>
			<option value="2019">2019</option>
			<option value="2018">2018</option>
			<option value="2017">2017</option>
			<option value="2016">2016</option>
			<option value="2015">2015</option>
			<option value="2014">2014</option>
			<option value="2013">2013</option>
			<option value="2012">2012</option>
			<option value="2011">2011</option>
			<option value="2010">2010</option>
			<option value="2009">2009</option>
			<option value="2008">2008</option>
			<option value="2007">2007</option>
			<option value="2006">2006</option>
			<option value="2005">2005</option>
			<option value="2004">2004</option>
			<option value="2003">2003</option>
			<option value="2002">2002</option>
			<option value="2001">2001</option>
			<option value="2000">2000</option>
			<option value="1999">1999</option>
			<option value="1998">1998</option>
			<option value="1997">1997</option>
			<option value="1996">1996</option>
			<option value="1995">1995</option>
			<option value="1994">1994</option>
			<option value="1993">1993</option>
			<option value="1992">1992</option>
			<option value="1991">1991</option>
			<option value="1990">1990</option>
		</select>
		for $
		<input type="number" id="purPrice" name="purPrice" min="1" max="999" value="250">
		<select class="selectbox" id="unit" name="unit" required>
			<option value="1000">thousand dollars</option>
			<option value="1000000">million dollars</option>
		</select>
		<br>
		<input type="button" value="How much is that in today's market?" onclick="displayResult()">
	</div>
	<br>
	<div id="divResult" style="text-align: center"></div>
	<br>
	<div id="hpiResult" style="text-align: center; display:none"></div>
	<br>

	<div style="width: 80%; margin: auto;">
		<canvas id="lineChart"></canvas>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

	<script>
		getChartData();

		let chart = new Chart(document.getElementById('lineChart'), {
			type: "line",
			data: {
				labels: xValuesChart,
				datasets: [{
					backgroundColor: "rgba(0,0,255,1.0)",
					borderColor: "rgba(0,0,255,0.1)",
					data: yValuesChart,
					label: 'NZ HPI Value',
				}]
			},
			options: {
				plugins: {
					title: {
						display: true,
						text: 'Last 5 Years of HPI Data (available back to 1990)'
					}
				}
			}
		});
	</script>
</body>

</html>